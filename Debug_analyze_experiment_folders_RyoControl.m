% cd FlyDiscoAnalysis
% matlab &
% <Now in Matlab>
%%
modpath
lab_head_last_name = 'branson' ;
do_use_bqueue = false ;    
do_actually_submit_jobs = false ;  

%% set params                                  
settings_folder_path = '/groups/branson/home/robiea/Code_versioned/FlyDiscoAnalysis/settings' ;

% analysis_protocol = '20210319_flybubble_LED_testing';
% analysis_protocol = 'current_non_olympiad_dickson_VNC';
% folder_path_from_experiment_index = { '/groups/branson/bransonlab/flydisco_data/VNC_YNA_K_162984_RigD_20210405T152704' } ;
% folder_path_from_experiment_index = {'/groups/branson/home/robiea/Projects_data/FlyDisco/Bubble_data/20210407_testingpipeline/VNC_YNA_K_162984_RigD_20210405T152704'};
% test with Kristin's Nan removal
% analysis_protocol = '20210409_flybubble_nonLED';
% folder_path_from_experiment_index = {'/groups/branson/home/robiea/Projects_data/FlyDisco/Bubble_data/20210409_testingpipeline/nochr_TrpA71G01_Unknown_RigA_20201216T162938'};
% folder_path_from_experiment_index = {'/groups/branson/home/robiea/Projects_data/FlyDisco/Bubble_data/20210409_testingpipeline/nochr_TrpA65F12_Unknown_RigD_20201216T175902'};
% analysis_protocol = '20210319_flybubble_LED_testing';

% analysis_protocol = 'current_non_olympiad_dickson_VNC';
% folder_path_from_experiment_index = {'/groups/branson/home/robiea/Projects_data/FlyDisco/TestSuite/FTtracked/FlyBubbleRGB/LED/VNC_JHS_K_85321_RigA_20210408T130721'};
% analysis_protocol =  '20210417_flybubble_LED';
% folder_path_from_experiment_index = {'/groups/branson/home/robiea/Projects_data/FlyDisco/TestSuite/FTtracked/FlyBubbleRGB/LED/VNC_JHS_K_85321_RigB_20210408T130659'};
% folder_path_from_experiment_index = {'/groups/branson/home/robiea/Projects_data/FlyDisco/TestSuite/FTtracked/FlyBubbleRGB/LED/VNC_JHS_K_85321_RigC_20210408T124720'};
% folder_path_from_experiment_index = {'/groups/branson/home/robiea/Projects_data/FlyDisco/TestSuite/FTtracked/FlyBubbleRGB/LED/VNC_JHS_K_85321_RigD_20210408T130906'};
% folder_path_from_experiment_index = {'/groups/branson/home/robiea/Projects_data/FlyDisco/Bubble_data/20210419_testingCtraxresultsmovie/VNC_JHS_K_85321_RigD_20210408T130906'};
% folder_path_from_experiment_index = {'/groups/branson/home/robiea/Projects_data/FlyDisco/Bubble_data/20210419_testingCtraxresultsmovie/VNC_JHS_K_85321_RigC_20210408T124720'};
%test run on cluster

% folder_path_from_experiment_index = {'/groups/branson/home/robiea/Projects_data/FlyDisco/Bubble_data/20210419_testingCtraxresultsmovie/VNC_JHS_K_85321_RigC_20210408T124720'};
% folder_path_from_experiment_index = {'/groups/branson/home/robiea/Projects_data/FlyDisco/Bubble_data/20210420_testingPipeline/VNC_JHS_K_85321_RigA_20210408T130721', ...
% '/groups/branson/home/robiea/Projects_data/FlyDisco/Bubble_data/20210420_testingPipeline/VNC_JHS_K_85321_RigB_20210408T130659', ...
% '/groups/branson/home/robiea/Projects_data/FlyDisco/Bubble_data/20210420_testingPipeline/VNC_JHS_K_85321_RigC_20210408T124720', ...
% '/groups/branson/home/robiea/Projects_data/FlyDisco/Bubble_data/20210420_testingPipeline/VNC_JHS_K_85321_RigD_20210408T130906'};

% analysis_protocol = 'current_non_olympiad_dickson_locomotionGtACR1_29_nonLED';
% folder_path_from_experiment_index = {'/groups/branson/home/robiea/Projects_data/FlyDisco/Bubble_data/20210420_testingCtraxresultsmovie/locomotionGtACR1_29_nonLED_JHS_K_85321_RigA_20210227T113908'};
% rootdir = '/groups/branson/bransonlab/flydisco_data';
% expdirs = textread('/groups/branson/home/robiea/Projects_data/FlyDisco/FlyDiscoPipeline/RyoRequests/20210423_processing.txt','%s');
% for i=1:numel(expdirs)
%     folder_path_from_experiment_index{i} = fullfile(rootdir,expdirs{i});
% end


% analysis_protocol = '20210531_flybubble_LED';
% folder_path_from_experiment_index = {'/groups/branson/home/robiea/Projects_data/FlyDisco/Bubble_data/20210713_perframefeatures/VNC_YNA_K_162984_RigB_20210602T135902'};
%     
%     % % whether or not to use fail/success flags
% do_force_analysis = true;    
% 
% % analysis_parameters = cell(1, 0) ;
% 
% analysis_parameters = {'analysis_protocol',analysis_protocol, ... 
%     'doautomaticchecksincoming','off',...
%     'doflytracking','off', ...
%     'doregistration','off',...
%     'doledonoffdetection','off',...
%     'dosexclassification','off',...
%     'dotrackwings','off',...
%     'docomputeperframefeatures','off',...
%     'docomputehoghofperframefeatures','off',...
%     'dojaabadetect','off',...
%     'docomputeperframestats','force',...
%     'doplotperframestats','off',...
%     'domakectraxresultsmovie','off',...
%     'doextradiagnostics','off',...
%     'doanalysisprotocol',isunix,...
%     'doautomaticcheckscomplete','off'};

% % %testing autocheckscomplete
% % analysis_protocol = '20210531_flybubble_LED_ARtestingperframe';
% folder_path_from_experiment_index = {'/groups/branson/home/robiea/Projects_data/FlyDisco/Bubble_data/20210713_perframefeatures/VNC_YNA_K_162984_RigB_20210602T135902'};
% %     
% %     % % whether or not to use fail/success flags
% % do_force_analysis = true;    
% % 
% % % analysis_parameters = cell(1, 0) ;
% % analysis_parameters = {'analysis_protocol',analysis_protocol, ... 
% %     'doautomaticchecksincoming','off',...
% %     'doflytracking','off', ...
% %     'doregistration','off',...
% %     'doledonoffdetection','off',...
% %     'dosexclassification','off',...
% %     'dotrackwings','off',...
% %     'docomputeperframefeatures','off',...
% %     'docomputehoghofperframefeatures','off',...
% %     'dojaabadetect','off',...
% %     'docomputeperframestats','off',...
% %     'doplotperframestats','off',...
% %     'domakectraxresultsmovie','off',...
% %     'doextradiagnostics','off',...
% %     'doanalysisprotocol',isunix,...
% %     'doautomaticcheckscomplete','force'};

% rerun registration, perframe to do autochecks
% 
folder_path_from_experiment_index = {'/groups/branson/home/robiea/Projects_data/FlyDisco/Bubble_data/20210621_APTTracking/VNC_JRC_SS42702_RigC_20210505T153129', ...
'/groups/branson/home/robiea/Projects_data/FlyDisco/Bubble_data/20210621_APTTracking/VNC_JRC_SS43522_RigC_20210412T131721', ...
'/groups/branson/home/robiea/Projects_data/FlyDisco/Bubble_data/20210621_APTTracking/VNC_JRC_SS43660_RigA_20210414T135538', ...
'/groups/branson/home/robiea/Projects_data/FlyDisco/Bubble_data/20210621_APTTracking/VNC_JRC_SS44231_RigA_20210419T141517', ...
'/groups/branson/home/robiea/Projects_data/FlyDisco/Bubble_data/20210621_APTTracking/VNC_JRC_SS46301_RigC_20210512T131504', ...
'/groups/branson/home/robiea/Projects_data/FlyDisco/Bubble_data/20210621_APTTracking/VNC_JRC_SS48619_RigA_20210426T141945', ...
'/groups/branson/home/robiea/Projects_data/FlyDisco/Bubble_data/20210621_APTTracking/VNC_JRC_SS49172_RigA_20210504T145545', ...
'/groups/branson/home/robiea/Projects_data/FlyDisco/Bubble_data/20210621_APTTracking/VNC_JRC_SS49220_RigB_20210421T143507', ...
'/groups/branson/home/robiea/Projects_data/FlyDisco/Bubble_data/20210621_APTTracking/VNC_JRC_SS51893_RigA_20210506T150106', ...
'/groups/branson/home/robiea/Projects_data/FlyDisco/Bubble_data/20210621_APTTracking/VNC_JRC_SS52094_RigA_20210602T144112', ...
'/groups/branson/home/robiea/Projects_data/FlyDisco/Bubble_data/20210621_APTTracking/VNC_JRC_SS52799_RigD_20210602T145135', ...
'/groups/branson/home/robiea/Projects_data/FlyDisco/Bubble_data/20210621_APTTracking/VNC_JRC_SS52985_RigA_20210503T152107', ...
'/groups/branson/home/robiea/Projects_data/FlyDisco/Bubble_data/20210621_APTTracking/VNC_JRC_SS60240_RigB_20210420T141142', ...
'/groups/branson/home/robiea/Projects_data/FlyDisco/Bubble_data/20210621_APTTracking/VNC_JRC_SS62706_RigA_20210525T134347', ...
'/groups/branson/home/robiea/Projects_data/FlyDisco/Bubble_data/20210621_APTTracking/VNC_JRC_SS64175_RigB_20210518T145000', ...
'/groups/branson/home/robiea/Projects_data/FlyDisco/Bubble_data/20210621_APTTracking/VNC_JRC_SS64214_RigA_20210520T151504', ...
'/groups/branson/home/robiea/Projects_data/FlyDisco/Bubble_data/20210621_APTTracking/VNC_JRC_SS64218_RigA_20210527T162508', ...
'/groups/branson/home/robiea/Projects_data/FlyDisco/Bubble_data/20210621_APTTracking/VNC_JRC_SS64234_RigC_20210513T154200', ...
'/groups/branson/home/robiea/Projects_data/FlyDisco/Bubble_data/20210621_APTTracking/VNC_JRC_SS65692_RigC_20210427T135618', ...
'/groups/branson/home/robiea/Projects_data/FlyDisco/Bubble_data/20210621_APTTracking/VNC_JRC_SS65710_RigB_20210513T142817', ...
'/groups/branson/home/robiea/Projects_data/FlyDisco/Bubble_data/20210621_APTTracking/VNC_JRC_SS65765_RigA_20210525T140224', ...
'/groups/branson/home/robiea/Projects_data/FlyDisco/Bubble_data/20210621_APTTracking/VNC_JRC_SS66932_RigA_20210525T153325', ...
'/groups/branson/home/robiea/Projects_data/FlyDisco/Bubble_data/20210621_APTTracking/VNC_JRC_SS67323_RigA_20210513T145544', ...
'/groups/branson/home/robiea/Projects_data/FlyDisco/Bubble_data/20210621_APTTracking/VNC_YNA_K_162984_RigA_20210519T153103', ...
'/groups/branson/home/robiea/Projects_data/FlyDisco/Bubble_data/20210621_APTTracking/VNC_YNA_K_162984_RigB_20210602T135902', ...
'/groups/branson/home/robiea/Projects_data/FlyDisco/Bubble_data/20210621_APTTracking/VNC_YNA_K_162984_RigC_20210604T152231', ...
'/groups/branson/home/robiea/Projects_data/FlyDisco/Bubble_data/20210621_APTTracking/VNC_YNA_K_162984_RigD_20210526T155055'};

analysis_protocol = '20210531_flybubble_LED_ARtestingperframe';
do_force_analysis = true;   

analysis_parameters = {'analysis_protocol',analysis_protocol, ... 
    'doautomaticchecksincoming','off',...
    'doflytracking','off', ...
    'doregistration','force',...
    'doledonoffdetection','off',...
    'dosexclassification','off',...
    'dotrackwings','off',...
    'docomputeperframefeatures','force',...
    'docomputehoghofperframefeatures','off',...
    'dojaabadetect','off',...
    'docomputeperframestats','off',...
    'doplotperframestats','off',...
    'domakectraxresultsmovie','off',...
    'doextradiagnostics','off',...
    'doanalysisprotocol',isunix,...
    'doautomaticcheckscomplete','off'};
%% run analysis

analyze_experiment_folders(folder_path_from_experiment_index, settings_folder_path, lab_head_last_name, ...
                           do_force_analysis, do_use_bqueue, do_actually_submit_jobs, analysis_parameters) ;