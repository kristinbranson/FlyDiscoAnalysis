%Debug_FlyBubblePipeline.m

modpath();


%% parameters
settingsdir = '/groups/branson/home/robiea/Code_versioned/FlyDiscoAnalysis/settings';

% analysis_protocol = '20210228_flybubble_dickson_locomotionGtACR1';
% analysis_protocol = '20210219_flybubble_dickson_nochrGtACR1testing'
%  analysis_protocol = '20210219_flybubble_dickson_nochrGtACR1testing';

% analysis_protocol = 'current_non_olympiad_dickson_locomotionGtACR1_29_nonLED';
% analysis_protocol = '20210311_flybubble_dickson_RGBGtACR1';
% analysis_protocol = '20210317_flybubble_dickson_pilotnonLED';
% analysis_protocol = '20210317_flybubble_LED_testing';
% analysis_protocol = '20210318_flybubble_LED_testing';
% analysis_protocol = '20210319_flybubble_LED_testing';
% analysis_protocol = '20210329_flybubble_FlyBowlRGB_LED';
% analysis_protocol = 'current_bubble';
analysis_protocol = '20210402_flybubble_flybowloptoKatie_mingrig_flytracker';

params = {'settingsdir',settingsdir,...
    'analysis_protocol',analysis_protocol, ...
    'forcecompute',false,...
    'doautomaticchecksincoming',true,...
    'doflytracking',true, ...
    'doregistration',true,...
    'doledonoffdetection',true,...
    'dosexclassification',false,...
    'dotrackwings',false,...
    'docomputeperframefeatures',false,...
    'docomputehoghofperframefeatures',false,...
    'dojaabadetect',false,...
    'docomputeperframestats',false,...
    'doplotperframestats',false,...
    'domakectraxresultsmovie',false,...
    'doextradiagnostics',false,...
    'doanalysisprotocol',isunix,...
    'doautomaticcheckscomplete',false};

%% experiment directory
% manually tracked by Alice 
% expdir = '/groups/branson/home/robiea/Projects_data/FlyDisco/Bubble_data/locomotionGtACR1_24_EXT_VGLUT-GAL4_RigA_20210226T095136';
% expdir = '/groups/branson/home/robiea/Projects_data/FlyDisco/Bubble_data/20210301_calibration/socialCsChr_GMR_72C11_AE_01_CsChrimson_RigD_20191114T172654';
% expdir = '/groups/branson/home/robiea/Projects_data/FlyDisco/Bubble_data/20210301_calibration/nochr_TrpA71G01_Unknown_RigA_20201216T162938';
% expdir = '/groups/branson/home/robiea/Projects_data/FlyDisco/Bubble_data/runbypipeline/locomotionGtACR1_24_EXT_VGLUT-GAL4_RigA_20210226T095136';
%
% expdir = '/groups/branson/home/robiea/Projects_data/FlyDisco/Bubble_data/FlyBubbleRGB/locomotionGtACR1_24_nonLED_JHS_K_85321_RigA_20210305T085013';
% expdir = '/groups/branson/home/robiea/Projects_data/FlyDisco/Bubble_data/FlyBubbleRGB/locomotionGtACR1_29_nonLED_JHS_K_85321_RigA_20210227T113908';
% test regular registration mark on new insert/flybubble holder
% expdir  = '/groups/branson/home/robiea/Projects_data/FlyDisco/Bubble_data/20210309_testingsmallovalindicator/locomotionGtACR1_24_nonLED_JHS_K_85321_GtACR1_RigA_20210309T171438';
% updating optoregistration 
% expdir = '/groups/branson/home/robiea/Projects_data/FlyDisco/Bubble_data/FlyBubbleRGB/locomotionGtACR1_24_RGB_EXT_VGLUT-GAL4_RigA_20210305T083721';
% expdir = '/groups/branson/home/robiea/Projects_data/FlyDisco/Bubble_data/FlyBubbleRGB/locomotionGtACR1_29_RGB_EXT_VGLUT-GAL4_RigA_20210227T115122';
% expdir = '/groups/branson/home/robiea/Projects_data/FlyDisco/Bubble_data/singlecolormarkers/pilot24RGB_JHS_K_85321_GtACR1_RigA_20210313T211624_BLUE';
% expdir =  '/groups/branson/home/robiea/Projects_data/FlyDisco/Bubble_data/singlecolormarkers/pilot24RGB_JHS_K_85321_GtACR1_RigA_20210313T211755_GRN';
% expdir =  '/groups/branson/home/robiea/Projects_data/FlyDisco/Bubble_data/singlecolormarkers/pilot24RGB_JHS_K_85321_GtACR1_RigA_20210313T211859_RED';

% explist = {'/groups/branson/home/robiea/Projects_data/FlyDisco/Bubble_data/singlecolormarkers/pilot24RGB_JHS_K_85321_GtACR1_RigA_20210313T212543_RED-oval',...
% '/groups/branson/home/robiea/Projects_data/FlyDisco/Bubble_data/singlecolormarkers/pilot24RGB_JHS_K_85321_GtACR1_RigA_20210313T212752_GRN-oval',...
% '/groups/branson/home/robiea/Projects_data/FlyDisco/Bubble_data/singlecolormarkers/pilot24RGB_JHS_K_85321_GtACR1_RigA_20210313T212914_BLUE-oval'};

% explist = {'/groups/branson/home/robiea/Projects_data/FlyDisco/Bubble_data/singlecolormarkers_try2/pilot24RGB_JHS_K_85321_GtACR1_RigA_20210313T212914_BLUE-oval', ...
% '/groups/branson/home/robiea/Projects_data/FlyDisco/Bubble_data/singlecolormarkers_try2/pilot24RGB_JHS_K_85321_GtACR1_RigA_20210313T212752_GRN-oval',...
% '/groups/branson/home/robiea/Projects_data/FlyDisco/Bubble_data/singlecolormarkers_try2/pilot24RGB_JHS_K_85321_GtACR1_RigA_20210313T212543_RED-oval'};
% explist = {'/groups/branson/home/robiea/Projects_data/FlyDisco/Bubble_data/singlecolormarkers_try2/pilot24RGB_JHS_K_85321_GtACR1_RigA_20210313T211624_BLUE'};
% explist = {'/groups/branson/home/robiea/Projects_data/FlyDisco/Bubble_data/singlecolormarkers_try2/pilot24RGB_JHS_K_85321_GtACR1_RigA_20210313T212914_BLUE-oval'};
% testing registration code on plates with string names 
% explist = {'/groups/branson/home/robiea/Projects_data/FlyDisco/Bubble_data/testlocomotion_registration/pilot24nonLED_JHS_K_85321_RigA_20210313T074451',...
% '/groups/branson/home/robiea/Projects_data/FlyDisco/Bubble_data/testlocomotion_registration/pilot29nonLED_JHS_K_85321_RigA_20210312T094943',...
% '/groups/branson/home/robiea/Projects_data/FlyDisco/Bubble_data/testlocomotion_registration/pilot29nonLED_JHS_K_85321_RigB_20210312T093513',...
% '/groups/branson/home/robiea/Projects_data/FlyDisco/Bubble_data/testlocomotion_registration/pilot29nonLED_JHS_K_85321_RigB_20210315T145016',...
% '/groups/branson/home/robiea/Projects_data/FlyDisco/Bubble_data/testlocomotion_registration/pilot29nonLED_JHS_K_85321_RigD_20210312T095812',...
% '/groups/branson/home/robiea/Projects_data/FlyDisco/Bubble_data/testlocomotion_registration/pilot29nonLED_JHS_K_85321_RigD_20210315T140458'};'
% testing LED indicators 
% explist = textread('/groups/branson/home/robiea/Projects_data/FlyDisco/FlyDiscoPipeline/explist_indicatorLEDsweep.txt','%s');
% explist = {'/groups/branson/bransonlab/alice/temp_bubbledata/singlecolormarkers/Slits/Red/pilot24nonLED_JHS_K_85321_GtACR1_RigA_20210317T211721'};
% explist = textread('/groups/branson/home/robiea/Projects_data/FlyDisco/FlyDiscoPipeline/explist_indicatorLEDsweep_2ndHalf.txt','%s');
% explist = textread('/groups/branson/home/robiea/Projects_data/FlyDisco/FlyDiscoPipeline/explist_insertLargeOval_smregistration.txt','%s');
% explist =  {'/groups/branson/bransonlab/alice/temp_bubbledata/singlecolormarkers/CenterLargeOval/Blue/pilotPTR_EXT_VGLUT-GAL4_GtACR1_RigA_20210318T142322'};
% explist = {'/groups/branson/home/robiea/Projects_data/FlyDisco/Bubble_data/20210319_RGBRyotestexperiments/pilot29RGB_EXT_VGLUT-GAL4_RigA_20210315T143243', ...
% explist = {'/groups/branson/home/robiea/Projects_data/FlyDisco/Bubble_data/20210319_RGBRyotestexperiments/pilot29RGB_JHS_K_85321_RigB_20210315T163334'};
% explist = {'/groups/branson/home/robiea/Projects_data/FlyDisco/Bubble_data/20210319_RGBRyotestexperiments/locomotionGtACR1_24_RGB_EXT_VGLUT-GAL4_RigA_20210226T095136'};
% explist = {'/groups/branson/home/robiea/Projects_data/FlyDisco/Bubble_data/20210319_RGBRyotestexperiments/locomotionGtACR1_24_RGB_EXT_VGLUT-GAL4_RigA_20210226T095136', ...
% '/groups/branson/home/robiea/Projects_data/FlyDisco/Bubble_data/20210319_RGBRyotestexperiments/pilot29RGB_EXT_VGLUT-GAL4_RigA_20210315T143243', ...
% '/groups/branson/home/robiea/Projects_data/FlyDisco/Bubble_data/20210319_RGBRyotestexperiments/pilot29RGB_JHS_K_85321_RigB_20210315T163334'};
% % testing FlyBowlRGB registration detection
% explist = {'/groups/branson/home/robiea/Projects_data/FlyDisco/KatieTestData/FlyBowlDisco_RGBonly_318/20210318T135921_rig1_flyBowl2__SS36564_CsChrim_KS_redonly_protocolRGB_0315_2', ...
% '/groups/branson/home/robiea/Projects_data/FlyDisco/KatieTestData/FlyBowlDisco_RGBonly_318/20210318T140029_rig1_flyBowl2__SS36564_CsChrim_KS_greenonly_protocolRGB_0315_2', ...
% '/groups/branson/home/robiea/Projects_data/FlyDisco/KatieTestData/FlyBowlDisco_RGBonly_318/20210318T140306_rig1_flyBowl2__SS36564_CsChrim_KS_blueonly_protocolRGB_0315_2'};
%testing ms protocol analysis_protocol = '20210319_flybubble_LED_testing';
% modified protocol.mat manually 
% explist = {'/groups/branson/home/robiea/Projects_data/FlyDisco/Bubble_data/2021030_testregiswithMSdurationedit/VNC_JRC_SS31881_RigB_20210325T144340'};
%testing registration on FlyBowlRGB analysis_protocol = '20210329_flybubble_FlyBowlRGB_LED';
% explist = {'/groups/branson/home/robiea/Projects_data/FlyDisco/KatieTestData/FlyBowlDisco_RGBonly_401/20210401T132850_rig1_flyBowl1__aIPgSS1UASCsChrimson_KS_redonly_protocolRGB_0315_2'}%, ...
% '/groups/branson/home/robiea/Projects_data/FlyDisco/KatieTestData/FlyBowlDisco_RGBonly_401/20210401T132850_rig1_flyBowl2__aIPgSS1UASCsChrimson_KS_redonly_protocolRGB_0315_2', ...
% '/groups/branson/home/robiea/Projects_data/FlyDisco/KatieTestData/FlyBowlDisco_RGBonly_401/20210401T132955_rig1_flyBowl1__aIPgSS1UASCsChrimson_KS_greenonly_protocolRGB_0315_2', ...
% '/groups/branson/home/robiea/Projects_data/FlyDisco/KatieTestData/FlyBowlDisco_RGBonly_401/20210401T132955_rig1_flyBowl2__aIPgSS1UASCsChrimson_KS_greenonly_protocolRGB_0315_2', ...
% '/groups/branson/home/robiea/Projects_data/FlyDisco/KatieTestData/FlyBowlDisco_RGBonly_401/20210401T133111_rig1_flyBowl1__aIPgSS1UASCsChrimson_KS_blueonly_protocolRGB_0315_2', ...
% '/groups/branson/home/robiea/Projects_data/FlyDisco/KatieTestData/FlyBowlDisco_RGBonly_401/20210401T133111_rig1_flyBowl2__aIPgSS1UASCsChrimson_KS_blueonly_protocolRGB_0315_2', ...
% '/groups/branson/home/robiea/Projects_data/FlyDisco/KatieTestData/FlyBowlDisco_RGBonly_401/20210401T134552_rig1_flyBowl3__aIPgSS1UASCsChrimson_KS_redonly_protocolRGB_0315_2', ...
% '/groups/branson/home/robiea/Projects_data/FlyDisco/KatieTestData/FlyBowlDisco_RGBonly_401/20210401T134552_rig1_flyBowl4__aIPgSS1UASCsChrimson_KS_redonly_protocolRGB_0315_2', ...
% '/groups/branson/home/robiea/Projects_data/FlyDisco/KatieTestData/FlyBowlDisco_RGBonly_401/20210401T134717_rig1_flyBowl3__aIPgSS1UASCsChrimson_KS_greenonly_protocolRGB_0315_2', ...
% '/groups/branson/home/robiea/Projects_data/FlyDisco/KatieTestData/FlyBowlDisco_RGBonly_401/20210401T134717_rig1_flyBowl4__aIPgSS1UASCsChrimson_KS_greenonly_protocolRGB_0315_2', ...
% '/groups/branson/home/robiea/Projects_data/FlyDisco/KatieTestData/FlyBowlDisco_RGBonly_401/20210401T134834_rig1_flyBowl3__aIPgSS1UASCsChrimson_KS_blueonly_protocolRGB_0315_2', ...
% '/groups/branson/home/robiea/Projects_data/FlyDisco/KatieTestData/FlyBowlDisco_RGBonly_401/20210401T134834_rig1_flyBowl4__aIPgSS1UASCsChrimson_KS_blueonly_protocolRGB_0315_2'};
% test registration on FlyBubble (pre tricolor backlight) % analysis_protocol = 'current_bubble';
% explist = {'/groups/branson/home/robiea/Projects_data/FlyDisco/Bubble_data/20210301_calibration/socialCsChr_GMR_72C11_AE_01_CsChrimson_RigD_20191114T172654'};
% test registraion on Ming's FlyBowlOpto analysis_protocol = '20210402_flybubble_flybowloptoKatie_mingrig_flytracker';
explist = {'/groups/branson/home/robiea/Projects_data/FlyDisco/KatieTestData/MingRig/20xUAS-ChrimsonRmVenusattp18_SS36564_flyBowlMing_20200916_Repeated_9min_5int_20201110T130435'};

%% run

% [success,msgs,stage] = FlyDiscoPipeline(expdir,params{:});


for i = 1:numel(explist)
    expdir = explist{i};
    FlyDiscoPipeline(expdir,params{:});
end
