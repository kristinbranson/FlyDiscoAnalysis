%reset_goldblum_example_experiments_working_copy_folder() ;

this_script_file_path = mfilename('fullpath') ;
this_script_folder_path = fileparts(this_script_file_path) ;
fly_disco_analysis_folder_path = fileparts(this_script_folder_path) ;

settings_folder_path = fullfile(fly_disco_analysis_folder_path, 'settings') ;

analysis_parameters = ...
        {'settingsdir', settings_folder_path, ...
         'doautomaticchecksincoming',true,...
         'doflytracking',true,...
         'doregistration',true,...
         'doledonoffdetection',true,...
         'dotrackwings',true,...
         'dosexclassification',true,...
         'docomputeperframefeatures',true,...
         'docomputehoghofperframefeatures',false,...
         'dojaabadetect',true,...
         'docomputeperframestats',false,...
         'doplotperframestats',false,...
         'domakectraxresultsmovie',false,...
         'doextradiagnostics',false,...
         'doanalysisprotocol',false,...
         'doautomaticcheckscomplete',false } ;

example_experiments_folder_path = ...
    fullfile(this_script_folder_path, ...
             'example-experiments-working-copy') ;        
     
folder_name_from_experiment_index = simple_dir(example_experiments_folder_path) ;
%do_run_from_experiment_index = true(size(folder_name_from_experiment_index)) ;  % modify this to run a subset
do_run_from_experiment_index = logical([0 0 1 1]) ;  % modify this to run a subset

experiment_count = length(folder_name_from_experiment_index) ;
for experiment_index = 1 : experiment_count ,
    do_run = do_run_from_experiment_index(experiment_index) ;
    if do_run ,    
        experiment_folder_name = folder_name_from_experiment_index{experiment_index} ;
        experiment_folder_path = fullfile(example_experiments_folder_path, experiment_folder_name) ;         

        fprintf('\n\n\nRunning FlyDiscoPipeline() on %s ...\n', experiment_folder_name) ;

        % Call the function to do the real work
        [success, msgs, stage] = FlyDiscoPipeline(experiment_folder_path, analysis_parameters{:}) ;

        % Report success/failure
        if success ,
            fprintf('FlyDiscoPipeline() ran successfully on experiment %s !\n', experiment_folder_name) ;
        else
            summary_message = sprintf('FlyDiscoPipeline() encountered one or more problems at stage %s for experiment %s:\n', stage, experiment_folder_name) ;
            for i = 1 : length(msgs) ,
                this_msg = msgs{i} ;
                fprintf('%s\n', this_msg) ;
            end
            error(summary_message) ;  %#ok<SPERR>
        end
    end
end
