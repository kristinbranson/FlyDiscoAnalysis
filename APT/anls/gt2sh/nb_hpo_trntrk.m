%% OBSOLETE SEE HPOptim.m

%%
td = load('f:\aptStephenCPRInvestigate20180327\trnData20180503.mat');
%%
TTFILES = { ...
'trntrk_sh_trn4523_gt080618_made20180627_cacheddata_hpo_outer3_easy_fold01_tblTrn_hpo_outer3_easy_fold01_tblTst_prm0_20180713_20180716T150605.mat'
'trntrk_sh_trn4523_gt080618_made20180627_cacheddata_hpo_outer3_easy_fold01_tblTrn_hpo_outer3_easy_fold01_tblTst_prm1_20180714_20180716T151001.mat'
'trntrk_sh_trn4523_gt080618_made20180627_cacheddata_hpo_outer3_easy_fold01_tblTrn_hpo_outer3_easy_fold01_tblTst_prm2_20180715_20180716T151015.mat'
'trntrk_sh_trn4523_gt080618_made20180627_cacheddata_hpo_outer3_easy_fold01_tblTrn_hpo_outer3_easy_fold01_tblTst_prm3_20180716_20180717T065118.mat'
'trntrk_sh_trn4523_gt080618_made20180627_cacheddata_hpo_outer3_hard_fold01_tblTrn_hpo_outer3_hard_fold01_tblTst_prm0_20180713_20180716T151142.mat'
'trntrk_sh_trn4523_gt080618_made20180627_cacheddata_hpo_outer3_hard_fold01_tblTrn_hpo_outer3_hard_fold01_tblTst_prm1_20180714_20180716T151200.mat'
'trntrk_sh_trn4523_gt080618_made20180627_cacheddata_hpo_outer3_hard_fold01_tblTrn_hpo_outer3_hard_fold01_tblTst_prm2_20180715_20180716T151225.mat'
'trntrk_sh_trn4523_gt080618_made20180627_cacheddata_hpo_outer3_hard_fold01_tblTrn_hpo_outer3_hard_fold01_tblTst_prm3_20180716_20180717T065155.mat'
};

tt = cellfun(@load,TTFILES,'uni',0);

errE = cat(3,tt{1}.tblRes.dLblTrk,tt{2}.tblRes.dLblTrk,...
             tt{3}.tblRes.dLblTrk,tt{4}.tblRes.dLblTrk);
errH = cat(3,tt{5}.tblRes.dLblTrk,tt{6}.tblRes.dLblTrk,...
             tt{7}.tblRes.dLblTrk,tt{8}.tblRes.dLblTrk);
dxyE = cellfun(@(x)x.tblRes.pTrk-x.tblRes.pLbl,tt(1:4),'uni',0);
dxyE = cat(3,dxyE{:});
dxyH = cellfun(@(x)x.tblRes.pTrk-x.tblRes.pLbl,tt(5:8),'uni',0);
dxyH = cat(3,dxyH{:});

errE = reshape(errE,size(errE,1),5,2,4); % n, pt, view, set
errH = reshape(errH,size(errH,1),5,2,4);
dxyE = reshape(dxyE,size(dxyE,1),5,2,2,4); % n, pt, view, x/y, set
dxyH = reshape(dxyH,size(dxyH,1),5,2,2,4); % etc
dxyE = permute(dxyE,[1 2 4 3 5]); % n, pt, x/y, view, set
dxyH = permute(dxyH,[1 2 4 3 5]);

% check one
dCheckE = sqrt(squeeze(sum(dxyE.^2,3))) - errE;
dCheckH = sqrt(squeeze(sum(dxyH.^2,3))) - errH;
fprintf(1,'Sanity checks dxy: max(abs(resid)))=%.3g, %.3g\n',...
  max(abs(dCheckE(:))),max(abs(dCheckH(:))));


%% TrnTrk Eval
DOSAVE = true;
SAVEDIR = 'figs';
SETNAMES = {'Round1' 'Round2' 'Round3' 'Round4'};
PTILES = [50 75 90 95 97.5 99];

hFig = [];

hFig(end+1) = figure(11);
hfig = hFig(end);
set(hfig,'Name','easy','Position',[2561 401 1920 1124]);
[~,ax] = GTPlot.ptileCurves(...
  errE,'hFig',hfig,...
  'setNames',SETNAMES,...
  'ptiles',PTILES,...
  'axisArgs',{'XTicklabelRotation',90,'FontSize',16});

hFig(end+1) = figure(15);
hfig = hFig(end);
set(hfig,'Name','hard','Position',[2561 401 1920 1124]);
[~,ax] = GTPlot.ptileCurves(...
  errH,'hFig',hfig,...
  'setNames',SETNAMES,...
  'ptiles',PTILES,...
  'axisArgs',{'XTicklabelRotation',90,'FontSize',16});

hFig(end+1) = figure(20);
hfig = hFig(end);
set(hfig,'Name','hardno99','Position',[2561 401 1920 1124]);
[~,ax] = GTPlot.ptileCurves(...
  errH,'hFig',hfig,...
  'setNames',SETNAMES,...
  'ptiles',[50 75 90 95 97.5],...
  'axisArgs',{'XTicklabelRotation',90,'FontSize',16});

hFig(end+1) = figure(25);
hfig = hFig(end);
set(hfig,'Name','easybullseye','Position',[2561 401 1920 1124]);
[~,ax] = GTPlot.bullseyePtiles(errE,...
  td.IMain20180503_crop2(1,:),squeeze(td.xyLblMain20180503_crop2(1,:,:,:)),...
  'hFig',hfig,...
  'setNames',SETNAMES,...
  'ptiles',PTILES,...
  'lineWidth',2,...
  'axisArgs',{'XTicklabelRotation',90,'FontSize',16});

hFig(end+1) = figure(27);
hfig = hFig(end);
set(hfig,'Name','easybullseyeell','Position',[2561 401 1920 1124]);
[~,ax] = GTPlot.bullseyePtiles(dxyE,...
  td.IMain20180503_crop2(1,:),squeeze(td.xyLblMain20180503_crop2(1,:,:,:)),...
  'hFig',hfig,...   
  'setNames',SETNAMES,...
  'ptiles',PTILES,...
  'lineWidth',1,... %  'axisArgs',{'XTicklabelRotation',90,'FontSize',16},...
  'contourtype','ellipse');

hFig(end+1) = figure(30);
hfig = hFig(end);
set(hfig,'Name','hardbullseye','Position',[2561 401 1920 1124]);
[~,ax] = GTPlot.bullseyePtiles(errH,...
  td.IMain20180503_crop2(1,:),squeeze(td.xyLblMain20180503_crop2(1,:,:,:)),...
  'hFig',hfig,...
  'setNames',SETNAMES,...
  'ptiles',PTILES,...
  'lineWidth',2,...
  'axisArgs',{'XTicklabelRotation',90,'FontSize',16});

hFig(end+1) = figure(32);
hfig = hFig(end);
set(hfig,'Name','hardbullseyeell','Position',[2561 401 1920 1124]);
[~,ax] = GTPlot.bullseyePtiles(dxyH,...
  td.IMain20180503_crop2(1,:),squeeze(td.xyLblMain20180503_crop2(1,:,:,:)),...
  'hFig',hfig,...   
  'setNames',SETNAMES,...
  'ptiles',PTILES,...
  'lineWidth',1,... %  'axisArgs',{'XTicklabelRotation',90,'FontSize',16},...
  'contourtype','ellipse');


if DOSAVE
  for i=1:numel(hFig)
    h = figure(hFig(i));
    fname = h.Name;
    hgsave(h,fullfile(SAVEDIR,[fname '.fig']));
    set(h,'PaperOrientation','landscape','PaperType','arch-d');
    print(h,'-dpdf',fullfile(SAVEDIR,[fname '.pdf']));  
    print(h,'-dpng','-r300',fullfile(SAVEDIR,[fname '.png']));   
    fprintf(1,'Saved %s.\n',fname);
  end
end